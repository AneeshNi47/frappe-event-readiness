[
 {
  "docstatus": 0,
  "doctype": "Custom HTML Block",
  "html": "<div style=\"text-align:right; margin-bottom:5px;\">\n  <!-- Create Sector: goes to Sector list -->\n  <button class=\"btn btn-danger\" onclick=\"open_create_sector_modal()\">Create Sector</button>\n\n  <!-- Add Sector Members: opens our JS dialog -->\n  <button class=\"btn btn-sm btn-warning\"\n          onclick=\"window.open_create_user_modal()\">\n    Add Sector Members\n  </button>\n\n  <!-- Create Event: opens new Event Readiness -->\n  <button class=\"btn btn-success\" onclick=\"open_create_event_modal()\">Create Event</button>\n</div>",
  "modified": "2025-12-03 21:01:37.177149",
  "name": "Create Event",
  "private": 0,
  "roles": [],
  "script": "window.open_create_user_modal = function () {\n    const d = new frappe.ui.Dialog({\n        title: \"Create User & Add to Sector\",\n        fields: [\n            {\n                label: \"Sector\",\n                fieldname: \"sector\",\n                fieldtype: \"Link\",\n                options: \"Sector\",\n                reqd: 1\n            },\n            {\n                label: \"Full Name\",\n                fieldname: \"full_name\",\n                fieldtype: \"Data\",\n                reqd: 1\n            },\n            {\n                label: \"Email\",\n                fieldname: \"email\",\n                fieldtype: \"Data\",\n                reqd: 1\n            },\n            {\n                label: \"Sector Lead?\",\n                fieldname: \"is_lead\",\n                fieldtype: \"Check\",\n                default: 0\n            }\n        ],\n        primary_action_label: \"Create User\",\n        primary_action(values) {\n            frappe.call({\n                method: \"psn_custom_rdb_app.psn_readiness_dashboard.event_logic.create_sector_user\",\n                args: values,\n                callback: function (r) {\n                    frappe.show_alert({\n                        message: __(\"User Created Successfully\"),\n                        indicator: \"green\"\n                    });\n                    d.hide();\n                    frappe.ui.toolbar.clear_cache();\n                },\n                error: function (err) {\n                    frappe.msgprint({\n                        title: \"Error\",\n                        message: err.message || \"Unable to create user\",\n                        indicator: \"red\"\n                    });\n                }\n            });\n        }\n    });\n\n    d.show();\n};\n\nwindow.open_create_sector_modal = function () {\n    let d = new frappe.ui.Dialog({\n        title: \"Create Sector\",\n        fields: [\n            { label: \"Sector Name\", fieldname: \"sector_name\", fieldtype: \"Data\", reqd: 1 },\n            { label: \"Sector Lead\", fieldname: \"sector_lead\", fieldtype: \"Link\", options: \"User\", reqd: 0 }\n        ],\n        primary_action_label: \"Create Sector\",\n        primary_action(values) {\n            frappe.call({\n                method: \"frappe.client.insert\",\n                args: {\n                    doc: {\n                        doctype: \"Sector\",\n                        sector_name: values.sector_name,\n                        sector_lead: values.sector_lead,\n                    }\n                },\n                callback(r) {\n                    frappe.show_alert(\"Sector Created âœ”\");\n                    d.hide();\n                    frappe.ui.toolbar.clear_cache();\n                }\n            });\n        }\n    });\n\n    d.show();\n};\n\nwindow.open_create_event_modal = function () {\n    let d = new frappe.ui.Dialog({\n        title: \"Create Event\",\n        fields: [\n            {\n                label: \"Event Name\",\n                fieldname: \"event_name\",\n                fieldtype: \"Data\",\n                reqd: 1\n            },\n            {\n                label: \"Event Start Date\",\n                fieldname: \"event_date\",\n                fieldtype: \"Date\",\n                reqd: 1,\n                description: \"Must be at least 1 day after today\"\n            },\n            {\n                label: \"Event End Date\",\n                fieldname: \"custom_event_end_date\",\n                fieldtype: \"Date\",\n                reqd: 1\n            },\n            {\n                label: \"Event Owner\",\n                fieldname: \"event_owner\",\n                fieldtype: \"Link\",\n                options: \"User\",\n                reqd: 1\n            },\n            {\n                label: \"Event Sponsor\",\n                fieldname: \"custom_event_sponsor\",\n                fieldtype: \"Data\",\n                reqd: 1\n            },\n            {\n                label: \"Event Description\",\n                fieldname: \"event_description\",\n                fieldtype: \"Small Text\",\n                reqd: 1\n            },\n            {\n                label: \"Use Default Task Template\",\n                fieldname: \"use_default_tasks\",\n                fieldtype: \"Check\",\n                default: 1\n            }\n        ],\n        primary_action_label: \"Create Event\",\n        primary_action(values) {\n\n            // -------------------------------\n            // DATE VALIDATION\n            // -------------------------------\n            const today = new Date();\n            const min_date = new Date(today.setDate(today.getDate() + 1));\n            const startDate = new Date(values.event_start_date);\n            const endDate = new Date(values.event_end_date);\n\n            if (startDate < min_date) {\n                frappe.msgprint({\n                    title: \"Invalid Start Date\",\n                    message: \"Event Start Date must be at least 1 day after today.\",\n                    indicator: \"red\"\n                });\n                return;\n            }\n\n            if (endDate <= startDate) {\n                frappe.msgprint({\n                    title: \"Invalid End Date\",\n                    message: \"Event End Date must be greater than Event Start Date.\",\n                    indicator: \"red\"\n                });\n                return;\n            }\n\n            // -------------------------------\n            // INSERT EVENT DOCUMENT\n            // -------------------------------\n            frappe.call({\n                method: \"frappe.client.insert\",\n                args: {\n                    doc: {\n                        doctype: \"Event Readiness\",\n                        event_name: values.event_name,\n                        event_date: values.event_date,\n                        custom_event_end_date: values.custom_event_end_date,\n                        event_owner: values.event_owner,\n                        custom_event_sponsor: values.custom_event_sponsor,\n                        event_description: values.event_description,\n                        use_default_tasks: values.use_default_tasks ? 1 : 0\n                    }\n                },\n                callback: function (r) {\n                    frappe.show_alert({\n                        message: __(\"Event Created\"),\n                        indicator: \"green\"\n                    });\n                    d.hide();\n\n                    frappe.set_route(\"Form\", \"Event Readiness\", r.message.name);\n                }\n            });\n        }\n    });\n\n    d.show();\n};",
  "style": null
 },
 {
  "docstatus": 0,
  "doctype": "Custom HTML Block",
  "html": "<div id=\"event-readiness-calendar\" style=\"height:500px;\"></div>",
  "modified": "2025-12-07 12:39:28.043028",
  "name": "Calendar View",
  "private": 0,
  "roles": [],
  "script": "frappe.require([\n    \"https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js\"\n], function () {\n\n    function load_event_calendar() {\n        const container = root_element.querySelector(\"#event-readiness-calendar\");\n\n        if (!container) {\n            console.warn(\"Calendar container not ready. Retrying...\");\n            setTimeout(load_event_calendar, 300);\n            return;\n        }\n\n        frappe.call({\n            method: \"frappe.client.get_list\",\n            args: {\n                doctype: \"Event Readiness\",\n                fields: [\"name\", \"event_name\", \"event_date\", \"custom_event_end_date\"]\n            },\n            callback(r) {\n                const events = (r.message || []).map(doc => ({\n                    id: doc.name,\n                    title: doc.event_name,\n                    start: doc.event_date,\n                    end: doc.custom_event_end_date,\n                    url: `/app/event-readiness/${doc.name}`\n                }));\n\n                const calendar = new FullCalendar.Calendar(container, {\n                    initialView: \"dayGridMonth\",\n                    height: 650,\n                    events: events\n                });\n\n                calendar.render();\n            }\n        });\n    }\n\n    load_event_calendar();\n});",
  "style": null
 }
]